# SSL Pinning
SSL Pinning is a security methodology used to ensure that application traffic is not intecepted (MITM)
- application verify that the received traffic is coming from a known certificate
- we can import a certificate into the phone as a root or user certificate but it could be not trusted by application
- this can cause our application to crash when we try to intercept the netword traffic



We could use two proxies:
- burpsuite
- proxyman


## android interception Process
1. start the proxy 
2. configure it
3. set the proxy of the emulator
4. intercept HTTP traffic
5. import CA certificate
6. trust CA certificate in Android Certificate Store
7. Intercept HTTPS traffic
	1. if is blocked by ssl pinning use objection / frida


## Dynamic analysis with MobSF 
To start the dynamic analysis with MobSF we have to configure it (android studio emulaor):

1. Add to PATH variable
	1. `export PATH=$PATH:/home/cristian/Android/Sdk/emulator`
2. see the list of emulators
	1. `emulator -list-avds`
3. run the emulator (choose one that supports root)
	1.  `emulator -avd Nexus_5_API_23 -writable-system -no-snapshot`



==**NOT WORKING**==

Now we have to start the docker of MobSF adding the emulator:
1. search for emulator number
	1. ![[Pasted image 20240319172426.png]]
2. run the docker:
	1. ` sudo docker run -it -e "MOBSF_ANALYZER_IDENTIFIER=emulator-5556" --rm -p 8000:8000 opensecurity/mobile-security-framework-mobsf:latest`





<mark style="background: #BBFABBA6;">WORKING PROCEDURE: (after running the emulator with the command emulator)</mark>
```shell
sudo ./run.sh
```




## burp suite

Go on burp:
- proxy -> proxy settings -> add -> add a new proxy with a port such as 8082 -> all interfaces (IMPORTANT)

Now we have to add the proxy in the emulator:
- 3 points -> settings -> proxy -> manual proxy -> add an address (maybe 127.0.0.1) -> add the port used on burp (8082)





IMPORTANTE:
Con gli emulatori nuovi non funziona quindi dobbiamo fare il revert a 33.1.1 
- https://developer.android.com/studio/emulator_archive?hl=it

Per scaricare apri con f12 la console e clicca sul banner 33.1.1, vedi che sotto c'Ã¨ una div con i link di download.

Scarica la versione 33.1.1 -> vai nella cartella Android/Sdk -> rinomina la cartella emulator in emulator_original -> unzip del download nella cartella Android/Sdk -> copia il file package.xml della cartella emulator_original in emulator -> aprilo e cambia < revision>< major>31< /major>< minor>1< /minor>< micro>1< /micro>< /revision>



Now we need a certificate:
- proxy settings -> import/export CA certificate -> export in DER format -> proxy_certificate.CER -> drop it into the android emulator (drag and drop)
- in emulator go to settings -> security -> credential store -> install from sd card -> search for the name of the certificate -> VPN and apps




Now it works!
