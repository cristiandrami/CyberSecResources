
# Pull APK from Google play



1. download the app from the Play Store
2. 
```bash
adb shell
pm list packages | grep < identifier (example injured) >

pm path <packageName> 
```
3. exit from abd
```shell
adb pull <pathPackage> <newName>.apk
```


# AndroidManifest.xml
It contains all the basics of the application:
- minSDKVersion
- Permissions 
- Activities
- Content Porviders

## Permissions 
Thei defines what data and hardware components the app needs access to:
- camera
- Contacts
- Internet
- ...

## Activities 
They are the UI elements or different "screens" in the application.
Some activities neet to be protected, for example:
- account details
- money transfer screens

An exported="True" activity can be accessed from the outside


## Content Provedrs 
They are utilized to serve data from our application to other applications. 
- Generally used to share data between some related apps.
- If content Providers are exported, this can be very dangerous and expose data to any user or app on the device



# Manual Static Analysis

To decompile an apk we could use apktool:
```shell
aptktool d file.apk #meglio usare questo, potrei non trovare tipo strings.xml altrimenti

apktool d file.apk -r #if we want to save time and not decompile resources
```

Its really important to have a look on the lib folder in order to see what it contains.

To read the strings contained int the libraries we can use
```shell 
cd InjuredAndroid/InjuredAndroid-1.0.12-release/lib
strings libapp.so
```


To read the strings used in the app we can see the file strings.xml
```shell
cd InjuredAndroid/InjuredAndroid-1.0.12-release/res/values

nano strings.xml
```



## How to find Hardcoded Strings


In general hardcoded strings can be found in `/resources/strings.xml` but sometimes they can be found also in activity source code.



**==So we can opend the apk with jadx==** and look at strings.xml:
- search for "password", "api", "http://" ecc



In jadx we can use text search to search in the entire souce code:
![[Pasted image 20240318171039.png]]




## Open exported activities
1. Look on the manifest which one activity has `exported="true"`
2. go to the terminal
```shell
adb shell
am start folder/.activity_name #always use  /. 

#example b3nac.injuredandroid.b25lActivity 
# am start b3nac.injuredandroid/.b25lActivity
```


## Enumerating Firebase Static Ananlysis
To enumerate the firebase DBs we could use this tool from github https://github.com/Sambal0x/firebaseEnum


```shell
python3 firebaseEnum.py -k company_name
```
- it tries to enumerate all possible databases with a wordlist


In the application we have already the url: `https://injuredandroid.firebaseio.com`

REMEMBER
- we could try to access to `/.json` on fire base databases

In this case if we access to `https://injuredandroid.firebaseio.com/.json` we obtain `"error" : "Permission denied"`


But in the activity code of the flag nine we can see: `byte[] decode = Base64.decode("ZmxhZ3Mv", 0);`  and if we decode it we obtain `flags/`
``

So we try to access to :
`https://injuredandroid.firebaseio.com/flags/.json` and we obtain the flag


==**Some portion of the database are not protected, so we can try to access to them and to .json file**==



## Automated static analysis with MobSF
We can download it from `git@github.com:MobSF/Mobile-Security-Framework-MobSF.git`

```shell 
docker pull opensecurity/mobile-security-framework-mobsf:latest

docker run -it --rm -p 8000:8000 opensecurity/mobile-security-framework-mobsf:latest
```
- then connect to localhost:8000 and upload the apk



WORKING PRACTICE:
```shell
sudo ./setup.sh

sudo ./run.sh
```


At this point we can connect to `localhost:8000`, upload the `.ipa` file and see the result of automatic static analysis.




