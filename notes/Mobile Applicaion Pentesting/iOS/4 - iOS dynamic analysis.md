
## burp suite

Go on burp:
- proxy -> proxy settings -> add -> add a new proxy with a port such as 8082 -> all interfaces (IMPORTANT)

Now we have to add the proxy in the iPhone:
- `settings` -> `WiFi` -> `click on the WiFi network connected` -> `configure proxy` ->`manual` 

Now we can put in:
- `Server` -> Mac IP address
- `Port` -> Port chosen in burp


We need to install burp certificate:
- in the iPhone go on browser to `http://burp:PORT_CHOSEN`
	- click on `CA Certificate` -> `Allow`
- on iPhone -> `Settings` -> `General` -> `Profile` -> install `Portswigger CA`
-  on iPhone -> `Settings` -> `General` -> `About` -> `Certificate Trust Settings` -> enable `Portswigger CA`

Now it could work, test it using the interceptor on burp



# Proxyman (alternative to Burp)

To install it ion the iPhone we can go to:
- `App Store` and install `Proxyman`

To install it on the MacOs we can follow the guide here [https://proxyman.io/](https://proxyman.io/)



On the Mac after installing Proxyman:

First thing to do is to go on 
`Certificate` -> `Install certificate on iOS` -> `Emulators/Physical` 

Now it will show the Ip and the port to put in the iPhone.


Now we have to add the proxy in the iPhone:
- `settings` -> `WiFi` -> `click on the WiFi network connected` -> `configure proxy` ->`manual` 

Now we can put in:
- `Server` -> shown IP address on proxyman
- `Port` -> shown port on proxyman


We need to install proxyman certificate:
- in the iPhone go on browser to `http://proxy.man/ssl`
	- click on `Allow`
- on iPhone -> `Settings` -> `General` -> `Profile` -> install `Proxyman CA`
-  on iPhone -> `Settings` -> `General` -> `About` -> `Certificate Trust Settings` -> enable `Proxyman CA`


Now we are able to intercept the traffic.



# SSL pinning iOS

In iOS we can use Objection to patch the `.ipa` file and disable the SSL pinning.
- this requires a physical device to receive a provisioning profile 
- it could not work in all cases


The most recent to do that is to use a jailbroken device and use tools like `SSL KillChain`.



# Objection 
1. We have to run our emulator
2. install frida tools
	1. `pip3 install frida-tools`
3. install objection (after frida)
	1. `pip3 install objection`

Now we need to install the provisioning profile on the device. This can be done only on **physical device**.

So open xCode and choose the physiscal device here:
- ![[Pasted image 20240705110603.png]]
- At this point we can click on the start button and the app will be installed

To **trust the profile** we need to go to :
- `general`->`profile and device management` -> `Trust the developement profile`




At this point we can use the command line to patch apps automatically:
```shell
objection patchipa --source file.ipa -c identity_signature
```
- `-c` is used to sign the `.ipa` with our developer profile 

**To find the identity signature** we need to run:
```shell
security find-identity
```
- here we need to copy the hash value that is the identity_signature


At this point we can install the new `.ipa` application on the iPhone and use objection.

To start to use the app and objection we have to run on the terminal:
```shell 
objection explore
```


For example SSL pinning:
```shell
ios sslpinning disable/enable
```


# Jailbreaking
We need jailbreak the iPhone to have access to encrypted data and traffic.

>Note: use a test account since you need to put credential in jailbroken device (it is dangerous)



One jailbreak we can use is `Check rain` accessible from [https://checkra.in/](https://checkra.in/)

From the link we can download and open the app on the Mac:
- ![[Pasted image 20240705112252.png]]

If the iOS version is not supported we can try to use it going to `options` and click on `Allow untested iOS versions`


To jailbreak the iPhone we need to click on `Start` and follow the guide:
- ![[Pasted image 20240705112522.png]]

We will have the iPhone in this state:
- ![[Pasted image 20240705112644.png]]
- ![[Pasted image 20240705112735.png]]

If the jailbreak is done you must see `Cydia` app:
- ![[Pasted image 20240705112807.png]]



# Jailbreak for iOS 15/16
To jailbreak iOS 15 or 16 we can use this guide [https://github.com/palera1n](https://github.com/palera1n)

To use it we need a physical MacBook, we cannot do it in a VM.

We can downlaod the version we need here [https://palera1n.com/](https://palera1n.com/)

In linux for example we can do:
- ![[Pasted image 20240705120437.png]]


To jailbreak we can follow the guide here [https://palera1n.com/pc/](https://palera1n.com/pc/)


# Burp suite mobile assistant 


To intall it we can follow this guide [https://portswigger.net/burp/documentation/desktop/tools/mobile-assistant/installing](https://portswigger.net/burp/documentation/desktop/tools/mobile-assistant/installing)

It is used for iOS devices.

To install it we can go to:
- `Cydia` -> `Sources` -> `Edit` -> `Add` -> `http://burp:PORT_OF_OUR_BURP` or `http://MAC_IP:PORT_OF_OUR_BURP`


Now from `Cydia` -> `Sources` -> `Burp` -> `All packages ` -> `mobile assistant`  we cna see tht is installed.


We open the mobile assistant form the iPhone and setup it:
- ![[Pasted image 20240705113524.png]]
	- MAC_IP and BURP_PORT


Now install the CA through `General`->`Profiles` -> `PortSwigger CA` -> `install`

# Burp iOS 15/16

To set it we need to go to `Settings` -> `WiFi` -> `Configure Proxy ` -> `Manual` -> Set server and Port with Mac IP and burp Port

Now visit `http://burp:PORT` -> `CA Certificate` -> `Allow`

At this point `Settings` -> `General` ->  `VPN and Device Management` -> install the certificate 
 `Settings` -> `General` ->  `About` -> `Certificate Trust Settings` -> Enable Portswigger


Now we just need to enable `SSL Kill Switch 2` from `Settings` ->`SSL Kill Switch 2`






# SSL KillChain (if burp assistant doesn't work)

We can downlaod it from [https://github.com/nabla-c0d3/ssl-kill-switch2](https://github.com/nabla-c0d3/ssl-kill-switch2)

In case of error we can follow this issue on github [https://github.com/nabla-c0d3/ssl-kill-switch2/issues/98](https://github.com/nabla-c0d3/ssl-kill-switch2/issues/98)


To have more tools on the iPhone we can install in `Cydia` `Substitute`

Now we need to install also `OpenSSH` from `Cydia`




To connect to our iPhone we can use 
```shell
ssh root@IPHONE_IP
```
- the password is always `alpine`


To get `wget` on the iPhone we need to follow the guide here [https://github.com/nabla-c0d3/ssl-kill-switch2/issues/98](https://github.com/nabla-c0d3/ssl-kill-switch2/issues/98)


Now from `Settings` and scroll down to `SSL Kill Switch 2` -> `Disable Certificate Validation`

Now we can intercept the traffic.



# SSL KillChain iOS 15/16

To connect to our iPhone we can use 
```shell
ssh root@IPHONE_IP
```
- the password is always `alpine`

From the root terminal :
```shell
wgetÂ https://github.com/nabla-c0d3/ssl-kill-switch2/releases/download/0.14/com.nablac0d3.sslkillswitch2_0.14.deb
```
- choose the latest version [https://github.com/nabla-c0d3/ssl-kill-switch2/releases](https://github.com/nabla-c0d3/ssl-kill-switch2/releases)

If wget is not found we can install it using in the root terminal:
```shell
sudo apt-get wget
```