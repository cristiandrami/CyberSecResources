Here we will use:
- `PMAT-labs/labs/3-3.OffScript-ScriptMalware/VBScript/Dropper.VBScript.vbs.malz.7z`

It is a visual basic script, a language almost equal to visual basic.

We extract the `.7z` file that contains 3 files:
- ![[Pasted image 20250212103838.png]]
- it seems to be in 2 stages

So we open the script in visual code:
- ![[Pasted image 20250212104213.png]]

It decodes `one.crt` into a file script called `one.vbs` and `two.crt` into `xml.xml`

Then it runs `one.vbs`, so it could be the real malware.


So we run it and then we go on `Â C:\Users\Public\Documents\one.vbs` to study this script.
- We need first to remove the execution:
- ![[Pasted image 20250212104414.png]]

Then we can run it:
- ![[Pasted image 20250212104512.png]]

Now we study these created files:
- ![[Pasted image 20250212104728.png]]

So we can see that:
1. the function `update` takes two arguments and replaces in the first argument (`string`) the second argument (`string`) with nothing
	1. So basically in this case `update(a, 'vVv')` removes from the string `vVv`

This is a type of string building.

We can remove all `vVv` using visual studio code:
- ![[Pasted image 20250212105041.png]]
- ![[Pasted image 20250212105128.png]]

Now we need to understand what does:
```powershell
Set obj = GetObject("new:C08AFD90-F2A1-11D1-8455-00A0C91F3880")
	obj.Document.Application.ShellExecute aaa, aaaa, Null, "runas", 0
```
1.  it creates an **ActiveX** object (`C08AFD90-F2A1-11D1-8455-00A0C91F3880`), that is a **Shell.Application**
2. uses `ShellExecute` to execute the file `MSBuild.exe` as a privileged user 
	1. it will use `xml.xml` as second parameter, that could be a payload

`MSBuild` is used compile `.NET` apps, or to run configuration scripts. So if we use some malicious `XML` files we can run malicious code
# xml.xml file 
At this point we have to study `xml.xml`:
- ![[Pasted image 20250212110714.png]]
We can see it executes a shellcode

We run the initial malware as admin and we can notice it creates a new user:
- ![[Pasted image 20250212111123.png]]
- `wsadmin` is a new user
- ![[Pasted image 20250212111157.png]]
- it is in the admin group
- ![[Pasted image 20250212111234.png]]
- it is also in the `Remote Desktop Users` so someone can connect in remote to our host using this account

