
In this section we will use:
- `PMAT-labs/labs/1-2.BasicDynamicAnalysis/RAT.Unknown.exe.malz/RAT.Unknown.exe.malz.7z`


# Run floss
we run floss and we redirect the output into a file:
```bash
 floss.exe RAT.Unknown.exe.malz > floss_output.txt
```
- ![[Pasted image 20250206140400.png]]


Here we can see very useful information:
- ![[Pasted image 20250206140511.png]]



# run the malware
Now we run it and we can see:
- ![[Pasted image 20250206140709.png]]
- after few seconds it shows a popup

But what happens under the cover?


# run inetsim
We run `inetsim` on REMnux to see if it tries to send requests on internet:
```bash
inetsim
```


And we run wireshark into REMnux:
```bash
sudo wireshark
```

We now run the malware and we look what happens:
- ![[Pasted image 20250206141149.png]]
- it does a request on a strange `url`
- it has a strange `User-Agent`

Another strange thing is that it sends a request for a file `msdcirelib.exe`:
- ![[Pasted image 20250206141306.png]]


So at this point we follow the stream of the `.exe` file request.
We click on the request and go to `Follow` -> `HTTP stream`
- ![[Pasted image 20250206141601.png]]
- ![[Pasted image 20250206141701.png]]
- it asks for a `.exe` file and downloads it (in this case it is the one served by our `inetsim`)


# Host based indicators
In `floss` we have seen a path:
- `@AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup`
	- ![[Pasted image 20250206142032.png]]

So we use `PROCmon` in order to understand what it is done on this path:
- ![[Pasted image 20250206142356.png]]

Now we filter on `operation` -> `file`:
- ![[Pasted image 20250206142431.png]]


And then we filter as `PATH` using `AppData\Roaming\Microsoft\Windows\Start`
:
- ![[Pasted image 20250206142542.png]]
- ![[Pasted image 20250206142553.png]]
- we have a lot of operations on that path that includes operation on files



We can see that the malware creates a `.exe` library file:
- ![[Pasted image 20250206142821.png]]


At this poin we go on the directory to see if the file is really created or not:
```
%AppData%
```
- in the seach bar we have to put this
- or we copy directly `C:\Users\vboxuser\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup` in a file explorer
- ![[Pasted image 20250206143108.png]]
- The file is really created in the folder


# Using TCPView
Now we use TCPVIew to understand the TCP traffic generated by the malware:
- ![[Pasted image 20250206143508.png]]


At this point we run the malware and we can see on TCPView that there is a port open (`5555`) in `listen` state:
- ![[Pasted image 20250206143650.png]]



# nc on the listen port

At this point we try to connect to the open port using `nc` on REMnux:
```bash
nc -nv 10.0.0.3 5555
```
- `10.0.0.3` is the windows IP
- ![[Pasted image 20250206143920.png]]


The connection sends us a `base64` string:
```bash
WytdIHdoYXQgY29tbWFuZCBjYW4gSSBydW4gZm9yIHlvdQ==
```
- with `cyberchef` online we can decrypt it
- ![[Pasted image 20250206144045.png]]


We can decrypt it also on terminal:
```bash
echo "WytdIHdoYXQgY29tbWFuZCBjYW4gSSBydW4gZm9yIHlvdQ==" | base64 -d
```
- ![[Pasted image 20250206144222.png]]



So it seems we can run commands...

# run commands 
We connect to the open port using `nc` on REMnux:
```bash
nc -nv 10.0.0.3 5555
```


And we start to send commands:
```bash
dir
```
- ![[Pasted image 20250206144616.png]]

We try to decrypt the result and we obtain `command not found`
- ![[Pasted image 20250206144605.png]]


So we try with `ipconfig`:
- ![[Pasted image 20250206144716.png]]

We decrypt it:
- ![[Pasted image 20250206144809.png]]


==**The malware opened a shell on our windows machine**==



It seems to be a remote access trojan.
