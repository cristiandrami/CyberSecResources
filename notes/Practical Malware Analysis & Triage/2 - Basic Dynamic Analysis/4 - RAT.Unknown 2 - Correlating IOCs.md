In this section we will study:
- `PMAT-labs/labs/1-2.BasicDynamicAnalysis/RAT.Unknown2.exe.malz/RAT.Unknown2.exe.7z`

The hases are 
```text
sha256: 481eae82ac4cd1a9cfadc026a628b18d7b4c54f50385d28c505fbcb3e999b8b0

md5: c211704777e168a5151de79dc87ffac7
```



# PEstudio
At this point we use `PEstudio` to retrieve any information about the executable file:
- ![[Pasted image 20250206155431.png]]

No important info, but useful ones.


# Start wireshark and run it

At this point we run  wireshark on REMnux.

We run the malware as administrators:
- ![[Pasted image 20250206155900.png]]


We can see that it does a request to a domain:
- ![[Pasted image 20250206160154.png]]

But this is not in the strings we can see with floss.
**==This because it uses a obfuscation mechanism that concatenates the strings at runtime in order to avoid this static analysis.==**


# changing hosts file
The malware is trying to reach is own domain. 

So we change the `hosts` file to force the resolution on our own machine:
```bash
nano C:\Windows\System32\drivers\etc\hosts
```
- ![[Pasted image 20250206160655.png]]
- and we put `127.0.0.1               aaaaaaaaaaaaaaaaaaaa.kadusus.local`


At this point we run `PROCmon` and we put a filter on `process name` and a filter on `operation ` -> `TCP`:
- ![[Pasted image 20250206161633.png]]
- it seems to do a request to the domain on port 443 (https)


We run a `netcat` on our windows, so our host become a server) then the malware connect to us and pops a shell
```bash
ncat -nvlp 443
```
- this on our windows machine
- ![[Pasted image 20250207110817.png]]

> Note: to make it work we have to change `C:\Windows\System32\drivers\etc\hosts`. 
- Then we have to change the `dns` settings in `View connections` -> `properties` -> `ipv4` -> and make the dns automatic!
# Parent-Child Process Analysis
Now if we click on the process tree:
- ![[Pasted image 20250207111133.png]]


An important thing is -> **the malware is a child process of `Explorer.exe`**:
- ![[Pasted image 20250207111319.png]]

Every interactive process in windows is a child of `explorer.exe`


However we can see that `RAT` runs subprocesses, called `child processes`:
- ![[Pasted image 20250207111203.png]]

It runs`cmd.exe` each time we run a command:
- ![[Pasted image 20250207111545.png]]


So `RAT.Unknown2.exe` is the parent process and runs a child process for each command we run, and this is very suspicious when we do an analysis!


We can put a filter on `parent PID`:
- 