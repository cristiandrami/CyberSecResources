In this case we will use:
- `PMAT-labs/labs/2-1.AdvancedStaticAnalysis/Malware.stage0.exe.malz/Malware.stage0.exe.malz.7z`


We do our static and dynamic analysis and we notice that when we run the malware it unpacks another `.exe` file in `Users\Public`:
- ![[Pasted image 20250210105334.png]]


We can also notice that it starts a connection on `localhost` trhough a program:
- ![[Pasted image 20250210105532.png]]

`WerFault` is a built in windows used to collect data when a progrma crashes or when the system crashes. It is used to send info to Microsoft about the crash.


At this point we analyse the new `.exe` file with cutter:
- ![[Pasted image 20250210110841.png]]


Opening the main function we can notice that it contains the standard path to perform a process injection:
- ![[Pasted image 20250210111200.png]]

In a simple view:
1. we are opening a process
2. we are allocating memoey in this program
3. we take data from the `lpbuffer` and put it into the virtual memory allocated 
	1. this buffer contains the shell code the malware wants to execute
	2. ![[Pasted image 20250210112220.png]]
	3. `0x40` stands for `RWX` permissions
4. with `CreateRemoteThread` to launch the new process

*A process injection is a malware strategy used to inject malicious code into another process is running on the system.*

# ncat
We try now to run a ncat on localhost on the port `8443` in order to see if the malware really connect to it:
- ![[Pasted image 20250210111924.png]]
- we got a shell


# Open ProcessHacker
If we open ProcessHacker we can study the new process:
- ![[Pasted image 20250210112451.png]]
- ![[Pasted image 20250210112518.png]]
	- we can see a `RWX` and if we open it we can see the bytes of the shellcode executed
	- ![[Pasted image 20250210112550.png]]
