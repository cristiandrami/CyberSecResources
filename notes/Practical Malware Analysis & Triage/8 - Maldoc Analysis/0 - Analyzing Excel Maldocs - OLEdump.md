In this section we will study:
- `PMAT-labs/labs/3-1.GonePhishing-MaldocAnalysis/Excel/sheetsForFinancial.7z`

A **maldoc** (short for _malicious document_) is a file, usually in **Word (.doc, .docx), Excel (.xls, .xlsx), PDF, or other document formats**, that contains malicious code designed to infect the victim's computer.


# What file is it?
It is a file that allows macros in excel:
- ![[Pasted image 20250211110522.png]]

We transfer it to our REMnux host:
```powershell
python -m http.server 80
# on windows
```
- ![[Pasted image 20250211110753.png]]

```bash
wget 10.0.0.3:80/sheetsForFinancial.xlsm
```
- ![[Pasted image 20250211110745.png]]

## unzip the excel file
A `.xlsm` file is like a `.zip` file that can be open in excel.
So we can unzip it using:
```bash
unzip sheetsForFinancial.xlsm
```
- ![[Pasted image 20250211111113.png]]
- `vbaProject.bin` seems suspicious

Since it is a `VBA` office macro we can use `oledump.py` to extract info:
```bash
oledump.py sheetsForFinancial.xlsm
```
- ![[Pasted image 20250211111608.png]]

This is interesting because we found a macro into a data string...


So to study it we can use:
```bash
oledump.py -s 3 sheetsForFinancial.xlsm
```
- `-s 3` takes the section A3 that is the suspicious one
- ![[Pasted image 20250211111822.png]]


We make it more readable:
```bash
oledump.py -s 3 -S sheetsForFinancial.xlsm
```
- ![[Pasted image 20250211111920.png]]
- ![[Pasted image 20250211111944.png]]

It seems to decode somenthing and then it runs a script bypassing the security checks of powershell.

To have all the info we need to study the malware we can run:
```bash
oledump.py -s 3 --vbadecompresscorrupt sheetsForFinancial.xlsm
```
- ![[Pasted image 20250211112249.png]]
- we have now the entire macro

1. It download something from `http://srv3.wonderballfinancial.local/abc123.crt`
2. It saves it into a file 
3. It runs a script using the downloaded `.cert` do decode something